<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking Card Testing - Bignor Park</title>
    <link rel="stylesheet" href="index-clean.css">
    <link rel="stylesheet" href="user-dropdown.css">
    <style>
        .test-page {
            max-width: 1200px;
            margin: 100px auto 40px;
            padding: 40px;
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .test-header h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .test-header p {
            color: #6c757d;
            font-size: 1.1rem;
        }
        
        .test-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .test-section h2 {
            color: #48d1cc;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .test-button {
            background: linear-gradient(135deg, #48d1cc 0%, #20b2aa 100%);
            color: white;
            border: none;
            padding: 20px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(72, 209, 204, 0.3);
            text-align: left;
        }
        
        .test-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(72, 209, 204, 0.4);
        }
        
        .test-button.danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
        }
        
        .test-button.info {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #2c3e50;
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
        }
        
        .test-button-icon {
            font-size: 1.5rem;
            display: block;
            margin-bottom: 8px;
        }
        
        .test-button-title {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .test-button-desc {
            font-size: 0.85rem;
            opacity: 0.9;
        }
        
        .info-box {
            background: #f0fffe;
            border-left: 4px solid #48d1cc;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .info-box h3 {
            color: #48d1cc;
            margin-bottom: 10px;
        }
        
        .info-box p {
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .info-box code {
            background: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-family: monospace;
            color: #dc3545;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .status-item {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            text-align: center;
        }
        
        .status-emoji {
            font-size: 2rem;
            display: block;
            margin-bottom: 10px;
        }
        
        .status-label {
            font-weight: 700;
            color: #2c3e50;
            display: block;
            margin-bottom: 5px;
        }
        
        .status-desc {
            font-size: 0.85rem;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <!-- Navigation Header (same as home.html) -->
    <header class="main-header">
        <div class="header-wrapper">
            <div class="logo-area">
                <img src="carp-logo.png" alt="Bignor Park" class="logo-img">
                <div class="logo-title">
                    <h1>Bignor Park</h1>
                    <span>CARP FISHERY</span>
                </div>
            </div>
            <nav class="main-nav">
                <a href="home.html">Home</a>
                <a href="booking.html" class="book-btn">Book</a>
                
                <!-- User Dropdown Menu -->
                <div class="user-menu-container" id="userMenuContainer">
                    <button class="user-menu-button" id="userMenuButton">
                        <div class="user-avatar" id="userAvatar">
                            <span id="userInitials">M</span>
                        </div>
                        <span id="userName" class="user-name">Member</span>
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </button>
                    
                    <div class="user-dropdown-menu" id="userDropdownMenu" role="menu" aria-hidden="true">
                        <div class="dropdown-header">
                            <div class="dropdown-user-info">
                                <div class="dropdown-avatar" id="dropdownAvatar">
                                    <span id="dropdownInitials">M</span>
                                </div>
                                <div class="dropdown-user-details">
                                    <div class="dropdown-user-name" id="dropdownUserName">Member</div>
                                    <div class="dropdown-user-email" id="dropdownUserEmail">member@email.com</div>
                                </div>
                            </div>
                            
                            <!-- Booking Status Indicator -->
                            <div class="dropdown-booking-status" id="dropdownBookingStatus" style="display: none;">
                                <span class="booking-status-dot"></span>
                                <div class="booking-status-text">
                                    <span class="booking-status-label">Active Booking</span>
                                    <span class="booking-status-details" id="bookingStatusDetails">Loading...</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="dropdown-divider"></div>
                        
                        <a href="home.html" class="dropdown-item">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                            </svg>
                            <span>Back to Home</span>
                        </a>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <div class="test-page">
        <div class="test-header">
            <h1>üß™ Booking Card Testing</h1>
            <p>Create test bookings and see them appear in the dropdown menu above!</p>
        </div>

        <!-- Create Bookings Section -->
        <div class="test-section">
            <h2>
                <span>üìÖ</span>
                Create Test Bookings
            </h2>
            <p>Click any button below to create a test booking. Then click your user avatar above to see the booking card!</p>
            
            <div class="button-grid">
                <button class="test-button" onclick="createTestBooking()">
                    <span class="test-button-icon">üìÖ</span>
                    <div class="test-button-title">Today's Booking</div>
                    <div class="test-button-desc">Starts today at midnight UTC</div>
                </button>
                
                <button class="test-button" onclick="createActiveTestBooking()">
                    <span class="test-button-icon">üé£</span>
                    <div class="test-button-title">Active Booking</div>
                    <div class="test-button-desc">Started 2 hours ago (currently active)</div>
                </button>
                
                <button class="test-button" onclick="createUpcomingTestBooking()">
                    <span class="test-button-icon">üóìÔ∏è</span>
                    <div class="test-button-title">Tomorrow's Booking</div>
                    <div class="test-button-desc">Starts tomorrow (upcoming)</div>
                </button>
                
                <button class="test-button danger" onclick="clearMyBooking()">
                    <span class="test-button-icon">üóëÔ∏è</span>
                    <div class="test-button-title">Clear Booking</div>
                    <div class="test-button-desc">Remove your current booking</div>
                </button>
                
                <button class="test-button info" onclick="checkMyBooking()">
                    <span class="test-button-icon">üîç</span>
                    <div class="test-button-title">Check Status</div>
                    <div class="test-button-desc">View current booking in console</div>
                </button>
                
                <button class="test-button info" onclick="window.location.href='home.html'">
                    <span class="test-button-icon">üè†</span>
                    <div class="test-button-title">Go to Home</div>
                    <div class="test-button-desc">Test persistence across pages</div>
                </button>
            </div>
        </div>

        <!-- Booking Status Types -->
        <div class="test-section">
            <h2>
                <span>üìä</span>
                Booking Status Types
            </h2>
            <p>Bookings can have three different statuses based on their timing:</p>
            
            <div class="status-grid">
                <div class="status-item">
                    <span class="status-emoji">üìÖ</span>
                    <span class="status-label">UPCOMING</span>
                    <span class="status-desc">Session hasn't started yet</span>
                </div>
                
                <div class="status-item">
                    <span class="status-emoji">üé£</span>
                    <span class="status-label">ACTIVE NOW</span>
                    <span class="status-desc">Currently fishing!</span>
                </div>
                
                <div class="status-item">
                    <span class="status-emoji">‚úÖ</span>
                    <span class="status-label">COMPLETED</span>
                    <span class="status-desc">Session has ended</span>
                </div>
            </div>
        </div>

        <!-- Instructions -->
        <div class="test-section">
            <h2>
                <span>üìù</span>
                Testing Instructions
            </h2>
            <ol style="line-height: 2; color: #2c3e50;">
                <li><strong>Create a Booking</strong> - Click one of the test booking buttons above</li>
                <li><strong>View the Card</strong> - Click your avatar/name in the top navigation</li>
                <li><strong>Test Persistence</strong> - Refresh the page, the booking should still be there</li>
                <li><strong>Navigate Away</strong> - Go to Home page, the booking persists</li>
                <li><strong>Wait for Expiry</strong> - Bookings auto-expire 24 hours after start time</li>
            </ol>
            
            <div class="info-box">
                <h3>‚ú® What to Look For</h3>
                <p>The booking card in the dropdown should show:</p>
                <ul style="margin-left: 20px;">
                    <li><strong>Carp logo</strong> at the top</li>
                    <li><strong>Status badge</strong> (Upcoming/Active Now/Completed)</li>
                    <li><strong>Lake name</strong> with location icon</li>
                    <li><strong>Session date</strong> with calendar icon</li>
                    <li><strong>Start time</strong> with clock icon (UTC)</li>
                    <li><strong>Click prompt</strong> to view full details</li>
                </ul>
            </div>
        </div>

        <!-- Console Commands -->
        <div class="test-section">
            <h2>
                <span>üíª</span>
                Console Commands
            </h2>
            <p>You can also test using browser console (F12):</p>
            
            <div class="info-box">
                <p><code>createTestBooking()</code> - Create today's booking</p>
                <p><code>createActiveTestBooking()</code> - Create active booking (started 2h ago)</p>
                <p><code>createUpcomingTestBooking()</code> - Create tomorrow's booking</p>
                <p><code>clearMyBooking()</code> - Clear your booking</p>
            </div>
        </div>
    </div>

    <script src="activeBooking.js"></script>
    <script src="booking-integration-utc.js"></script>
    <script src="user-dropdown.js"></script>
    <script src="index-clean.js"></script>
    
    <script>
        // Additional test function
        function checkMyBooking() {
            const currentUserData = localStorage.getItem('currentUser');
            if (!currentUserData) {
                alert('‚ùå No user logged in.\n\nPlease sign in first!');
                return;
            }
            
            const currentUser = JSON.parse(currentUserData);
            const booking = window.ActiveBookingSystem?.getActiveBooking(currentUser.email);
            
            if (booking) {
                console.log('‚úÖ Active Booking Found:', booking);
                const display = window.ActiveBookingSystem.formatBookingForDisplay(booking);
                console.log('üìä Formatted Display:', display);
                
                alert(`‚úÖ Active Booking Found!\n\nLake: ${booking.lakeName}\nStatus: ${display.status}\nDate: ${display.sessionDate}\nTime: ${display.startTime} UTC\n\nCheck console for full details.`);
            } else {
                console.log('‚ùå No active booking found');
                alert('‚ùå No active booking found.\n\nCreate one using the buttons above!');
            }
        }
        
        // Display current user info
        window.addEventListener('DOMContentLoaded', function() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            if (currentUser) {
                console.log('üë§ Current User:', currentUser.fullName || currentUser.email);
                console.log('üìß Email:', currentUser.email);
                
                // Check for existing booking
                if (window.ActiveBookingSystem) {
                    const booking = window.ActiveBookingSystem.getActiveBooking(currentUser.email);
                    if (booking) {
                        console.log('üìÖ Existing booking found:', booking.lakeName);
                    }
                }
            } else {
                console.warn('‚ö†Ô∏è No user logged in. Please sign in to test bookings.');
            }
        });
    </script>
</body>
</html>

















